@import "tailwindcss";
@import "tw-animate-css";

@plugin '@tailwindcss/typography';

@custom-variant dark (&:is(.dark *));

@utility container {
  margin-inline: auto;
  padding-inline: 2rem;
  @media (width >= --theme(--breakpoint-sm)) {
    max-width: none;
  }
  @media (width >= 1400px) {
    max-width: 1400px;
  }
}

@theme inline {
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-background: var(--background);
  --color-foreground: var(--foreground);

  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);

  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);

  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);

  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);

  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);

  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);

  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);

  --color-sidebar: var(--sidebar-background);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --animate-collapse-down: collapse-down 0.1s ease-in-out;
  --animate-collapse-up: collapse-up 0.1s ease-in-out;
  --animate-collapsible-down: collapsible-down 0.2s ease-out;
  --animate-collapsible-up: collapsible-up 0.2s ease-out;
  --animate-bounce-dot: bounce-dot 1s infinite;

  --font-sans: var(--font-sans), ui-serif, Georgia, Cambria, "Times New Roman",
    Times, serif;
  --font-serif: var(--font-serif), ui-serif, Georgia, Cambria, "Times New Roman",
    Times, serif;
  --font-mono: var(--font-mono), ui-monospace, SFMono-Regular, Menlo, Monaco,
    Consolas, "Liberation Mono", "Courier New", monospace;

  @keyframes collapse-down {
    from {
      height: 0;
      opacity: 0;
    }
    to {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
  }
  @keyframes collapse-up {
    from {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
    to {
      height: 0;
      opacity: 0;
    }
  }
  @keyframes collapsible-down {
    from {
      height: 0;
      opacity: 0;
    }
    to {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
  }
  @keyframes collapsible-up {
    from {
      height: var(--radix-collapsible-content-height);
      opacity: 1;
    }
    to {
      height: 0;
      opacity: 0;
    }
  }
  @keyframes bounce-dot {
    0%,
    100% {
      transform: translateY(0);
      animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
    }
    50% {
      transform: translateY(-25%);
      animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
    }
  }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

@utility scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
  &::-webkit-scrollbar {
    display: none;
  }
}

@utility animate-pulse-scale {
  animation: pulse-scale 2s ease-in-out infinite;
}

@utility animate-fade-in {
  animation: fade-in 0.3s ease-out forwards;
}

@utility pill-button {
  /* ============================================
     Shared UI Utilities
     ============================================ */

  /* Pill button style */
  @apply inline-flex items-center justify-center gap-1.5 h-8 px-2.5 rounded-full;
  @apply text-xs font-medium transition-colors duration-200;
  @apply border border-input bg-background;
  @apply focus:outline-hidden focus-visible:ring-1 focus-visible:ring-ring;
  @apply disabled:pointer-events-none disabled:opacity-50;
}

@utility pill-button-inactive {
  @apply text-muted-foreground hover:bg-accent hover:text-accent-foreground;
}

@utility pill-button-active {
  @apply bg-primary text-primary-foreground border-primary hover:bg-primary/90;
}

@utility input-container {
  /* Input container style - matches chat input container */
  @apply bg-muted rounded-full border border-input;
}

@utility icon-button {
  /* Icon button style - consistent size and rounding */
  @apply inline-flex items-center justify-center size-8 rounded-full;
  @apply transition-colors duration-200;
  @apply text-muted-foreground hover:text-foreground hover:bg-accent;
  @apply focus:outline-hidden focus-visible:ring-1 focus-visible:ring-ring;
  @apply disabled:pointer-events-none disabled:opacity-50;
}

@utility floating-panel {
  /* Floating panel style - matches toast/indicator panels */
  @apply bg-muted/95 backdrop-blur-xs border border-input shadow-lg rounded-3xl;
  @apply transition-all duration-200;
}

@utility sticky-header {
  /* Sticky header style - consistent backdrop blur */
  @apply sticky top-0 z-20 bg-background/95 backdrop-blur-xs;
  @apply border-b border-border/40;
  @apply transition-shadow duration-200;
}

@utility heading-greeting {
  /* Consistent heading style - matches chat greeting */
  @apply text-[1.625rem] font-semibold;
}

@utility kbd-hint {
  /* Keyboard hint style - consistent kbd styling */
  @apply px-1.5 py-0.5 text-[10px] font-mono bg-muted/70 border border-border/40 rounded-full;
}

:root {
  /* Vintage Paper Theme - Light Mode */
  --background: hsl(43 38% 93%);
  --foreground: hsl(29 17% 25%);
  --card: hsl(43 100% 98%);
  --card-foreground: hsl(29 17% 25%);
  --popover: hsl(43 100% 98%);
  --popover-foreground: hsl(29 17% 25%);
  --primary: hsl(29 36% 49%);
  --primary-foreground: hsl(0 0% 100%);
  --secondary: hsl(41 34% 83%);
  --secondary-foreground: hsl(29 19% 30%);
  --muted: hsl(39 34% 89%);
  --muted-foreground: hsl(30 19% 41%);
  --accent: hsl(41 31% 75%);
  --accent-foreground: hsl(29 17% 25%);
  --destructive: hsl(10 54% 46%);
  --destructive-foreground: hsl(0 0% 100%);
  --border: hsl(40 33% 80%);
  --input: hsl(40 33% 80%);
  --ring: hsl(29 36% 49%);
  --radius: 1rem;
  /* Sidebar */
  --sidebar-background: hsl(43 38% 93%);
  --sidebar-foreground: hsl(29 17% 25%);
  --sidebar-primary: hsl(29 36% 49%);
  --sidebar-primary-foreground: hsl(0 0% 100%);
  --sidebar-accent: hsl(41 31% 75%);
  --sidebar-accent-foreground: hsl(29 17% 25%);
  --sidebar-border: hsl(40 33% 80%);
  --sidebar-ring: hsl(29 36% 49%);
}

.dark {
  /* Vintage Paper Theme - Dark Mode */
  --background: hsl(20 14% 15%);
  --foreground: hsl(39 34% 89%);
  --card: hsl(20 14% 20%);
  --card-foreground: hsl(39 34% 89%);
  --popover: hsl(20 14% 20%);
  --popover-foreground: hsl(39 34% 89%);
  --primary: hsl(30 33% 63%);
  --primary-foreground: hsl(20 14% 15%);
  --secondary: hsl(20 12% 25%);
  --secondary-foreground: hsl(39 34% 89%);
  --muted: hsl(20 14% 20%);
  --muted-foreground: hsl(35 15% 73%);
  --accent: hsl(24 15% 30%);
  --accent-foreground: hsl(39 34% 89%);
  --destructive: hsl(10 54% 46%);
  --destructive-foreground: hsl(0 0% 100%);
  --border: hsl(20 12% 25%);
  --input: hsl(20 12% 25%);
  --ring: hsl(30 33% 63%);
  /* Sidebar */
  --sidebar-background: hsl(20 14% 15%);
  --sidebar-foreground: hsl(39 34% 89%);
  --sidebar-primary: hsl(30 33% 63%);
  --sidebar-primary-foreground: hsl(20 14% 15%);
  --sidebar-accent: hsl(24 15% 30%);
  --sidebar-accent-foreground: hsl(39 34% 89%);
  --sidebar-border: hsl(20 12% 25%);
  --sidebar-ring: hsl(30 33% 63%);
}

@layer base {
  * {
    @apply border-border;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  *::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  *::-webkit-scrollbar-track {
    background: transparent;
  }

  *::-webkit-scrollbar-thumb {
    background-color: var(--border);
    border-radius: 9999px;
  }

  *::-webkit-scrollbar-thumb:hover {
    background-color: var(--border);
  }

  html,
  body {
    @apply overflow-x-hidden;
    max-width: 100vw;
  }

  body {
    @apply bg-background text-foreground;
  }

  .prose pre {
    @apply overflow-x-auto max-w-full;
  }

  .prose code {
    @apply break-all;
  }

  .prose table {
    @apply overflow-x-auto block max-w-full;
  }

  .prose p,
  .prose li,
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    @apply wrap-break-word;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }

  .prose ol,
  .prose ul {
    @apply max-w-full overflow-hidden;
  }

  #scroll-container {
    max-width: 100vw;
  }

  .codeblock {
    max-width: 100%;
  }

  @media (max-width: 768px) {
    .prose,
    .prose > * {
      @apply wrap-break-word;
      overflow-wrap: break-word;
      word-wrap: break-word;
      max-width: 100%;
    }

    .codeblock {
      max-width: calc(100vw - 2rem);
      font-size: 0.75rem;
    }

    .chat-section {
      max-width: 100%;
      overflow-x: hidden;
    }
  }
}

@keyframes pulse-scale {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
}

@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* KaTeX Math Rendering - Dark Mode Support */
.dark .katex,
.dark .katex-display {
  color: var(--foreground);
}

.dark .katex .mord,
.dark .katex .mbin,
.dark .katex .mrel,
.dark .katex .mopen,
.dark .katex .mclose,
.dark .katex .mpunct,
.dark .katex .minner {
  color: inherit;
}

.dark .katex .frac-line {
  border-color: var(--foreground);
  background: var(--foreground);
}

.dark .katex .sqrt-line {
  border-color: var(--foreground);
}

.dark .katex .sqrt > .sqrt-sign {
  color: var(--foreground);
}

.dark .katex .delimsizing,
.dark .katex .delimsizinginner {
  color: var(--foreground);
}

.dark .katex .vertical-separator {
  border-color: var(--foreground);
}

.dark .katex .hline {
  border-color: var(--foreground);
}

.dark .katex .accent-body > span,
.dark .katex .stretchy {
  color: var(--foreground);
}

.dark .katex a {
  color: var(--primary);
}

.dark .katex .katex-error {
  color: var(--destructive);
}

/* ============================================
   Command Menu (cmdk) Scroll Fixes
   ============================================ */

/* Ensure cmdk list is scrollable */
[cmdk-list] {
  max-height: min(400px, 50vh);
  overflow-y: auto;
  overflow-x: hidden;
  overscroll-behavior: contain;
  scroll-behavior: smooth;
  scrollbar-gutter: stable;
}

/* Smooth scrolling for command items when selected */
[cmdk-item][data-selected="true"] {
  scroll-margin: 8px;
}

/* Command group proper overflow handling */
[cmdk-group] {
  overflow: visible;
}
