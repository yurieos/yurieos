@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Vintage Paper Theme - Light Mode */
    --background: 43 38% 93%;
    --foreground: 29 17% 25%;
    --card: 43 100% 98%;
    --card-foreground: 29 17% 25%;
    --popover: 43 100% 98%;
    --popover-foreground: 29 17% 25%;
    --primary: 29 36% 49%;
    --primary-foreground: 0 0% 100%;
    --secondary: 41 34% 83%;
    --secondary-foreground: 29 19% 30%;
    --muted: 39 34% 89%;
    --muted-foreground: 30 19% 41%;
    --accent: 41 31% 75%;
    --accent-foreground: 29 17% 25%;
    --destructive: 10 54% 46%;
    --destructive-foreground: 0 0% 100%;
    --border: 40 33% 80%;
    --input: 40 33% 80%;
    --ring: 29 36% 49%;
    --radius: 0.25rem;
    /* Sidebar */
    --sidebar-background: 43 38% 93%;
    --sidebar-foreground: 29 17% 25%;
    --sidebar-primary: 29 36% 49%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 41 31% 75%;
    --sidebar-accent-foreground: 29 17% 25%;
    --sidebar-border: 40 33% 80%;
    --sidebar-ring: 29 36% 49%;
  }

  .dark {
    /* Vintage Paper Theme - Dark Mode */
    --background: 20 14% 15%;
    --foreground: 39 34% 89%;
    --card: 20 14% 20%;
    --card-foreground: 39 34% 89%;
    --popover: 20 14% 20%;
    --popover-foreground: 39 34% 89%;
    --primary: 30 33% 63%;
    --primary-foreground: 20 14% 15%;
    --secondary: 20 12% 25%;
    --secondary-foreground: 39 34% 89%;
    --muted: 20 14% 20%;
    --muted-foreground: 35 15% 73%;
    --accent: 24 15% 30%;
    --accent-foreground: 39 34% 89%;
    --destructive: 10 54% 46%;
    --destructive-foreground: 0 0% 100%;
    --border: 20 12% 25%;
    --input: 20 12% 25%;
    --ring: 30 33% 63%;
    /* Sidebar */
    --sidebar-background: 20 14% 15%;
    --sidebar-foreground: 39 34% 89%;
    --sidebar-primary: 30 33% 63%;
    --sidebar-primary-foreground: 20 14% 15%;
    --sidebar-accent: 24 15% 30%;
    --sidebar-accent-foreground: 39 34% 89%;
    --sidebar-border: 20 12% 25%;
    --sidebar-ring: 30 33% 63%;
  }
}

@layer base {
  * {
    @apply border-border;
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--border)) transparent;
  }

  *::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  *::-webkit-scrollbar-track {
    background: transparent;
  }

  *::-webkit-scrollbar-thumb {
    background-color: hsl(var(--border));
    border-radius: 4px;
  }

  *::-webkit-scrollbar-thumb:hover {
    background-color: hsl(var(--border));
  }

  html,
  body {
    @apply overflow-x-hidden;
    max-width: 100vw;
  }

  body {
    @apply bg-background text-foreground;
  }

  .prose pre {
    @apply overflow-x-auto max-w-full;
  }

  .prose code {
    @apply break-all;
  }

  .prose table {
    @apply overflow-x-auto block max-w-full;
  }

  .prose p,
  .prose li,
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    @apply break-words;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }

  .prose ol,
  .prose ul {
    @apply max-w-full overflow-hidden;
  }

  #scroll-container {
    max-width: 100vw;
  }

  .codeblock {
    max-width: 100%;
  }

  @media (max-width: 768px) {
    .prose,
    .prose > * {
      @apply break-words;
      overflow-wrap: break-word;
      word-wrap: break-word;
      max-width: 100%;
    }

    .codeblock {
      max-width: calc(100vw - 2rem);
      font-size: 0.75rem;
    }

    .chat-section {
      max-width: 100%;
      overflow-x: hidden;
    }
  }
}

@layer utilities {
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  .animate-pulse-scale {
    animation: pulse-scale 2s ease-in-out infinite;
  }

  .animate-fade-in {
    animation: fade-in 0.3s ease-out forwards;
  }

  /* ============================================
     Shared UI Utilities - Consistent Chat/Notes Styling
     ============================================ */

  /* Pill button style - matches chat's DeepResearchToggle */
  .pill-button {
    @apply inline-flex items-center justify-center gap-1.5 h-8 px-2.5 rounded-lg;
    @apply text-xs font-medium transition-colors duration-200;
    @apply border border-input bg-background;
    @apply focus:outline-none focus-visible:ring-1 focus-visible:ring-ring;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }

  .pill-button-inactive {
    @apply text-muted-foreground hover:bg-accent hover:text-accent-foreground;
  }

  .pill-button-active {
    @apply bg-primary text-primary-foreground border-primary hover:bg-primary/90;
  }

  /* Input container style - matches chat input container */
  .input-container {
    @apply bg-muted rounded-lg border border-input;
  }

  /* Icon button style - consistent size and rounding */
  .icon-button {
    @apply inline-flex items-center justify-center size-8 rounded-lg;
    @apply transition-colors duration-200;
    @apply text-muted-foreground hover:text-foreground hover:bg-accent;
    @apply focus:outline-none focus-visible:ring-1 focus-visible:ring-ring;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }

  /* Floating panel style - matches toast/indicator panels */
  .floating-panel {
    @apply bg-muted/95 backdrop-blur-sm border border-input shadow-lg rounded-lg;
    @apply transition-all duration-200;
  }

  /* Sticky header style - consistent backdrop blur */
  .sticky-header {
    @apply sticky top-0 z-20 bg-background/95 backdrop-blur-sm;
    @apply border-b border-border/40;
    @apply transition-shadow duration-200;
  }

  /* Consistent heading style - matches chat greeting */
  .heading-greeting {
    @apply text-[1.625rem] font-semibold;
  }

  /* Keyboard hint style - consistent kbd styling */
  .kbd-hint {
    @apply px-1.5 py-0.5 text-[10px] font-mono bg-muted/70 border border-border/40 rounded;
  }
}

@keyframes pulse-scale {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
}

@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* KaTeX Math Rendering - Dark Mode Support */
.dark .katex,
.dark .katex-display {
  color: hsl(var(--foreground));
}

.dark .katex .mord,
.dark .katex .mbin,
.dark .katex .mrel,
.dark .katex .mopen,
.dark .katex .mclose,
.dark .katex .mpunct,
.dark .katex .minner {
  color: inherit;
}

.dark .katex .frac-line {
  border-color: hsl(var(--foreground));
  background: hsl(var(--foreground));
}

.dark .katex .sqrt-line {
  border-color: hsl(var(--foreground));
}

.dark .katex .sqrt > .sqrt-sign {
  color: hsl(var(--foreground));
}

.dark .katex .delimsizing,
.dark .katex .delimsizinginner {
  color: hsl(var(--foreground));
}

.dark .katex .vertical-separator {
  border-color: hsl(var(--foreground));
}

.dark .katex .hline {
  border-color: hsl(var(--foreground));
}

.dark .katex .accent-body > span,
.dark .katex .stretchy {
  color: hsl(var(--foreground));
}

.dark .katex a {
  color: hsl(var(--primary));
}

.dark .katex .katex-error {
  color: hsl(var(--destructive));
}

/* ============================================
   BlockNote Editor Theme - Vintage Paper
   ============================================ */

/* BlockNote container - override default theme colors */
.bn-container,
.bn-editor {
  --bn-colors-editor-background: hsl(var(--background));
  --bn-colors-editor-text: hsl(var(--foreground));
  --bn-colors-menu-background: hsl(var(--popover));
  --bn-colors-menu-text: hsl(var(--popover-foreground));
  --bn-colors-hovered-background: hsl(var(--accent));
  --bn-colors-selected-background: hsl(var(--accent));
  --bn-colors-tooltip-background: hsl(var(--popover));
  --bn-colors-tooltip-text: hsl(var(--popover-foreground));
  --bn-colors-side-menu: hsl(var(--muted-foreground));
  --bn-border-radius: var(--radius);
  font-family: inherit;

  /* Highlight colors - Light mode (default) */
  --bn-colors-highlights-gray-text: #6b5d4d;
  --bn-colors-highlights-gray-background: #e3dcd0;
  --bn-colors-highlights-brown-text: #6b4423;
  --bn-colors-highlights-brown-background: #e8d5c4;
  --bn-colors-highlights-red-text: #9b2c2c;
  --bn-colors-highlights-red-background: #fed7d7;
  --bn-colors-highlights-orange-text: #c05621;
  --bn-colors-highlights-orange-background: #feebc8;
  --bn-colors-highlights-yellow-text: #975a16;
  --bn-colors-highlights-yellow-background: #fefcbf;
  --bn-colors-highlights-green-text: #276749;
  --bn-colors-highlights-green-background: #c6f6d5;
  --bn-colors-highlights-blue-text: #2b6cb0;
  --bn-colors-highlights-blue-background: #bee3f8;
  --bn-colors-highlights-purple-text: #6b46c1;
  --bn-colors-highlights-purple-background: #e9d8fd;
  --bn-colors-highlights-pink-text: #b83280;
  --bn-colors-highlights-pink-background: #fed7e2;
}

/* BlockNote highlight colors - Dark mode */
.dark .bn-container,
.dark .bn-editor {
  --bn-colors-highlights-gray-text: #b8a892;
  --bn-colors-highlights-gray-background: #3d3530;
  --bn-colors-highlights-brown-text: #d4a574;
  --bn-colors-highlights-brown-background: #4a3728;
  --bn-colors-highlights-red-text: #fc8181;
  --bn-colors-highlights-red-background: #4a2020;
  --bn-colors-highlights-orange-text: #f6ad55;
  --bn-colors-highlights-orange-background: #4a2c10;
  --bn-colors-highlights-yellow-text: #ecc94b;
  --bn-colors-highlights-yellow-background: #4a3d10;
  --bn-colors-highlights-green-text: #68d391;
  --bn-colors-highlights-green-background: #1c3d2a;
  --bn-colors-highlights-blue-text: #63b3ed;
  --bn-colors-highlights-blue-background: #1a3650;
  --bn-colors-highlights-purple-text: #b794f4;
  --bn-colors-highlights-purple-background: #382952;
  --bn-colors-highlights-pink-text: #f687b3;
  --bn-colors-highlights-pink-background: #4a1d33;
}

/* BlockNote editor background */
.bn-editor {
  background: transparent !important;
}

/* ============================================
   BlockNote ShadCN Theme Integration
   Uses existing ShadCN theme variables
   ============================================ */

/* BlockNote ShadCN container border styles */
@layer base {
  .bn-shadcn * {
    @apply border-border outline-ring/50;
  }
}

/* BlockNote ShadCN menu styling - Light Mode */
.bn-shadcn [data-radix-popper-content-wrapper] {
  z-index: 50 !important;
}

/* BlockNote toolbar buttons */
.bn-shadcn button[data-active='true'] {
  background-color: hsl(var(--accent)) !important;
}

/* BlockNote dropdown menus - compact & consistent */
.bn-shadcn [data-radix-menu-content],
.bn-shadcn .bn-dropdown-menu {
  background-color: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  padding: 4px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
}

.bn-shadcn [data-radix-menu-content] [role='menuitem'],
.bn-shadcn .bn-dropdown-menu-item {
  border-radius: 4px !important;
  padding: 6px 8px !important;
  font-size: 13px !important;
  gap: 8px !important;
}

.bn-shadcn [data-radix-menu-content] [role='menuitem']:hover,
.bn-shadcn [data-radix-menu-content] [role='menuitem'][data-highlighted],
.bn-shadcn .bn-dropdown-menu-item:hover {
  background-color: hsl(var(--accent)) !important;
}

/* BlockNote color picker - compact */
.bn-shadcn .bn-color-picker,
.bn-shadcn [class*='ColorPicker'] {
  padding: 6px !important;
  gap: 4px !important;
}

.bn-shadcn .bn-color-picker button,
.bn-shadcn [class*='ColorPicker'] button {
  width: 20px !important;
  height: 20px !important;
  border-radius: 4px !important;
}

/* BlockNote side menu dropdown - compact */
.bn-shadcn .bn-side-menu [data-radix-menu-content] {
  min-width: 160px !important;
}

/* ============================================
   BlockNote Suggestion Menu - Compact & App-consistent
   ============================================ */

.bn-shadcn .bn-suggestion-menu {
  background-color: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
  padding: 4px !important;
  max-height: min(320px, 45vh) !important;
  overflow-y: auto !important;
  overscroll-behavior: contain !important;
  min-width: 280px !important;
  width: auto !important;
  max-width: 320px !important;
}

/* Suggestion menu group header - compact */
.bn-shadcn .bn-suggestion-menu-label {
  font-size: 10px !important;
  font-weight: 500 !important;
  color: hsl(var(--muted-foreground)) !important;
  text-transform: uppercase !important;
  letter-spacing: 0.05em !important;
  padding: 6px 8px 4px !important;
  margin: 0 !important;
}

/* Suggestion menu items - compact sizing */
.bn-shadcn .bn-suggestion-menu-item {
  background-color: transparent !important;
  color: hsl(var(--popover-foreground)) !important;
  border-radius: 4px !important;
  padding: 6px 8px !important;
  margin: 1px 0 !important;
  font-size: 13px !important;
  line-height: 1.3 !important;
  gap: 8px !important;
  min-height: auto !important;
  cursor: pointer !important;
}

/* Suggestion menu item icon container */
.bn-shadcn .bn-suggestion-menu-item > div:first-child {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 22px !important;
  height: 22px !important;
  flex-shrink: 0 !important;
  border-radius: 4px !important;
  background: hsl(var(--muted) / 0.5) !important;
}

/* Suggestion menu item icon */
.bn-shadcn .bn-suggestion-menu-item svg {
  width: 14px !important;
  height: 14px !important;
  opacity: 0.8 !important;
}

/* Suggestion menu item text content wrapper */
.bn-shadcn .bn-suggestion-menu-item > div:nth-child(2) {
  display: flex !important;
  flex-direction: column !important;
  gap: 0 !important;
  min-width: 0 !important;
  flex: 1 !important;
}

/* Suggestion menu item title */
.bn-shadcn .bn-suggestion-menu-item-title {
  font-size: 13px !important;
  font-weight: 450 !important;
  line-height: 1.3 !important;
  color: hsl(var(--foreground)) !important;
}

/* Suggestion menu item subtitle/description - hidden as fallback */
.bn-shadcn .bn-suggestion-menu-item [class*='subtext'],
.bn-shadcn .bn-suggestion-menu-item [class*='subtitle'] {
  display: none !important;
}

.bn-shadcn .bn-suggestion-menu-item:hover,
.bn-shadcn .bn-suggestion-menu-item[aria-selected='true'] {
  background-color: hsl(var(--accent)) !important;
}

.bn-shadcn .bn-suggestion-menu-item[aria-selected='true'] > div:first-child {
  background: hsl(var(--accent-foreground) / 0.1) !important;
}

/* BlockNote grid suggestion menu (emoji picker) - compact */
.bn-shadcn .bn-grid-suggestion-menu {
  background-color: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  padding: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
}

.bn-shadcn .bn-grid-suggestion-menu-item {
  border-radius: 4px !important;
  transition: background-color 0.1s ease;
  padding: 4px !important;
}

.bn-shadcn .bn-grid-suggestion-menu-item:hover,
.bn-shadcn .bn-grid-suggestion-menu-item[aria-selected='true'] {
  background-color: hsl(var(--accent)) !important;
}

.dark .bn-shadcn .bn-grid-suggestion-menu {
  box-shadow:
    0 4px 16px -4px rgba(0, 0, 0, 0.35),
    0 2px 8px -2px rgba(0, 0, 0, 0.25) !important;
}

/* Dark mode adjustments for BlockNote ShadCN */
.dark .bn-shadcn .bn-suggestion-menu {
  box-shadow:
    0 4px 16px -4px rgba(0, 0, 0, 0.35),
    0 2px 8px -2px rgba(0, 0, 0, 0.25) !important;
  border-color: hsl(var(--border) / 0.8) !important;
}

.dark .bn-shadcn .bn-suggestion-menu-item > div:first-child {
  background: hsl(var(--muted) / 0.3) !important;
}

/* ============================================
   BlockNote-specific Styling
   ============================================ */

/* ============================================
   BlockNote Suggestion Menu (Slash Commands) - Scroll & Sizing
   ============================================ */

/* 
 * BlockNote's SuggestionMenuController uses floating-ui which dynamically
 * sets maxHeight on the floating container. Override for compact sizing.
 */

/* Target the suggestion menu directly - compact sizing */
.bn-suggestion-menu {
  max-height: min(320px, 45vh) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  overscroll-behavior: contain !important;
  scroll-behavior: smooth !important;
  min-width: 280px !important;
  max-width: 320px !important;
}

/* Also target when scoped to shadcn theme */
.bn-shadcn .bn-suggestion-menu {
  max-height: min(320px, 45vh) !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  overscroll-behavior: contain !important;
  scroll-behavior: smooth !important;
}

/* Ensure the floating container allows scrolling */
div[style*='z-index: 80'] .bn-suggestion-menu,
div[style*='zIndex'] .bn-suggestion-menu {
  max-height: min(320px, 45vh) !important;
  overflow-y: auto !important;
}

/* Ensure suggestion menu items scroll into view when selected */
.bn-suggestion-menu-item[aria-selected='true'] {
  scroll-margin: 4px;
}

/* Custom scrollbar for the suggestion menu - thin & subtle */
.bn-suggestion-menu::-webkit-scrollbar,
.slash-menu-container ::-webkit-scrollbar {
  width: 6px;
}

.bn-suggestion-menu::-webkit-scrollbar-track,
.slash-menu-container ::-webkit-scrollbar-track {
  background: transparent;
}

.bn-suggestion-menu::-webkit-scrollbar-thumb,
.slash-menu-container ::-webkit-scrollbar-thumb {
  background-color: hsl(var(--border) / 0.6);
  border-radius: 3px;
}

.bn-suggestion-menu::-webkit-scrollbar-thumb:hover,
.slash-menu-container ::-webkit-scrollbar-thumb:hover {
  background-color: hsl(var(--border));
}

/* ============================================
   Custom Slash Menu - Clean & Minimal
   ============================================ */

.slash-menu-container {
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08);
  animation: slash-menu-enter 0.15s ease-out;
}

.dark .slash-menu-container {
  box-shadow:
    0 4px 16px -4px rgba(0, 0, 0, 0.35),
    0 2px 8px -2px rgba(0, 0, 0, 0.25);
}

@keyframes slash-menu-enter {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* BlockNote font - use app font */
.bn-container,
.bn-editor,
.bn-block-content,
.bn-inline-content {
  font-family:
    var(--font-sans), ui-serif, Georgia, Cambria, 'Times New Roman', Times,
    serif !important;
}

/* BlockNote side menu (drag handle, add button) */
.bn-side-menu {
  opacity: 0;
  transition: opacity 0.15s ease;
  margin-left: -8px !important;
}

.bn-block-outer:hover .bn-side-menu,
.bn-side-menu:hover {
  opacity: 1;
}

.bn-side-menu button {
  color: hsl(var(--muted-foreground)) !important;
  border-radius: 0 !important;
  transition:
    background-color 0.15s ease,
    color 0.15s ease;
}

.bn-side-menu button:hover {
  background: hsl(var(--accent)) !important;
  color: hsl(var(--accent-foreground)) !important;
}

/* BlockNote drag handle */
.bn-drag-handle {
  color: hsl(var(--muted-foreground)) !important;
}

.bn-drag-handle:hover {
  color: hsl(var(--foreground)) !important;
}

/* BlockNote table styling */
.bn-table-handle {
  background: hsl(var(--muted)) !important;
  border-color: hsl(var(--border)) !important;
}

/* BlockNote placeholder text */
.bn-block-content[data-content-type='paragraph']
  .bn-inline-content:empty::before,
.bn-editor [data-placeholder]::before {
  color: hsl(var(--muted-foreground)) !important;
  opacity: 0.5;
}

/* BlockNote code blocks - custom component handles its own styling */
.bn-block-content[data-content-type='codeBlock'] {
  background: transparent !important;
  border-radius: 0 !important;
  padding: 0 !important;
}

/* BlockNote headings - ensure proper contrast in all modes */
.bn-block-content[data-content-type='heading'],
.bn-block-content[data-content-type='heading'] .bn-inline-content,
.bn-editor .bn-block-content[data-content-type='heading'] {
  color: hsl(var(--foreground)) !important;
}

/* Heading level-specific styling for light mode - warmer brown tones */
.bn-block-content[data-content-type='heading'][data-level='1'] {
  color: #3d362f !important;
}

.bn-block-content[data-content-type='heading'][data-level='2'] {
  color: #4a4239 !important;
}

.bn-block-content[data-content-type='heading'][data-level='3'] {
  color: #5a5249 !important;
}

/* Dark mode headings */
.dark .bn-block-content[data-content-type='heading'],
.dark .bn-block-content[data-content-type='heading'] .bn-inline-content,
.dark .bn-editor .bn-block-content[data-content-type='heading'] {
  color: hsl(var(--foreground)) !important;
}

.dark .bn-block-content[data-content-type='heading'][data-level='1'] {
  color: #f5f0e6 !important;
}

.dark .bn-block-content[data-content-type='heading'][data-level='2'] {
  color: #e8e0d4 !important;
}

.dark .bn-block-content[data-content-type='heading'][data-level='3'] {
  color: #d9d0c3 !important;
}

/* BlockNote lists - ensure proper contrast */
.bn-block-content[data-content-type='bulletListItem'],
.bn-block-content[data-content-type='numberedListItem'],
.bn-block-content[data-content-type='checkListItem'] {
  color: hsl(var(--foreground)) !important;
}

/* BlockNote paragraphs - ensure proper contrast */
.bn-block-content[data-content-type='paragraph'],
.bn-block-content[data-content-type='paragraph'] .bn-inline-content {
  color: hsl(var(--foreground)) !important;
}

/* ============================================
   BlockNote Text Colors - Override with theme colors
   These must come after the base styles to take precedence
   ============================================ */

/* Default color - reset to theme foreground */
.bn-editor [data-text-color='default'],
.bn-editor [data-style-type='textColor'][data-value='default'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='default']) {
  color: hsl(var(--foreground)) !important;
}

.bn-editor [data-background-color='default'],
.bn-editor [data-style-type='backgroundColor'][data-value='default'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='default']) {
  background-color: transparent !important;
}

/* Inline highlight styling - add padding and rounded corners */
.bn-editor .bn-inline-content [data-style-type='backgroundColor'] {
  padding: 2px 4px;
  border-radius: 3px;
  margin: 0 1px;
}

/* Text colors - Light mode */
.bn-editor [data-text-color='gray'],
.bn-editor [data-style-type='textColor'][data-value='gray'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='gray']) {
  color: #6b5d4d !important;
}

.bn-editor [data-text-color='brown'],
.bn-editor [data-style-type='textColor'][data-value='brown'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='brown']) {
  color: #6b4423 !important;
}

.bn-editor [data-text-color='red'],
.bn-editor [data-style-type='textColor'][data-value='red'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='red']) {
  color: #9b2c2c !important;
}

.bn-editor [data-text-color='orange'],
.bn-editor [data-style-type='textColor'][data-value='orange'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='orange']) {
  color: #c05621 !important;
}

.bn-editor [data-text-color='yellow'],
.bn-editor [data-style-type='textColor'][data-value='yellow'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='yellow']) {
  color: #975a16 !important;
}

.bn-editor [data-text-color='green'],
.bn-editor [data-style-type='textColor'][data-value='green'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='green']) {
  color: #276749 !important;
}

.bn-editor [data-text-color='blue'],
.bn-editor [data-style-type='textColor'][data-value='blue'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='blue']) {
  color: #2b6cb0 !important;
}

.bn-editor [data-text-color='purple'],
.bn-editor [data-style-type='textColor'][data-value='purple'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='purple']) {
  color: #6b46c1 !important;
}

.bn-editor [data-text-color='pink'],
.bn-editor [data-style-type='textColor'][data-value='pink'],
.bn-editor .bn-block:has(> .bn-block-content[data-text-color='pink']) {
  color: #b83280 !important;
}

/* Background colors - Light mode */
.bn-editor [data-background-color='gray'],
.bn-editor [data-style-type='backgroundColor'][data-value='gray'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='gray']) {
  background-color: #e3dcd0 !important;
}

.bn-editor [data-background-color='brown'],
.bn-editor [data-style-type='backgroundColor'][data-value='brown'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='brown']) {
  background-color: #e8d5c4 !important;
}

.bn-editor [data-background-color='red'],
.bn-editor [data-style-type='backgroundColor'][data-value='red'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='red']) {
  background-color: #fed7d7 !important;
}

.bn-editor [data-background-color='orange'],
.bn-editor [data-style-type='backgroundColor'][data-value='orange'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='orange']) {
  background-color: #feebc8 !important;
}

.bn-editor [data-background-color='yellow'],
.bn-editor [data-style-type='backgroundColor'][data-value='yellow'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='yellow']) {
  background-color: #fefcbf !important;
}

.bn-editor [data-background-color='green'],
.bn-editor [data-style-type='backgroundColor'][data-value='green'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='green']) {
  background-color: #c6f6d5 !important;
}

.bn-editor [data-background-color='blue'],
.bn-editor [data-style-type='backgroundColor'][data-value='blue'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='blue']) {
  background-color: #bee3f8 !important;
}

.bn-editor [data-background-color='purple'],
.bn-editor [data-style-type='backgroundColor'][data-value='purple'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='purple']) {
  background-color: #e9d8fd !important;
}

.bn-editor [data-background-color='pink'],
.bn-editor [data-style-type='backgroundColor'][data-value='pink'],
.bn-editor .bn-block:has(> .bn-block-content[data-background-color='pink']) {
  background-color: #fed7e2 !important;
}

/* Text colors - Dark mode */
.dark .bn-editor [data-text-color='gray'],
.dark .bn-editor [data-style-type='textColor'][data-value='gray'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='gray']) {
  color: #b8a892 !important;
}

.dark .bn-editor [data-text-color='brown'],
.dark .bn-editor [data-style-type='textColor'][data-value='brown'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='brown']) {
  color: #d4a574 !important;
}

.dark .bn-editor [data-text-color='red'],
.dark .bn-editor [data-style-type='textColor'][data-value='red'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='red']) {
  color: #fc8181 !important;
}

.dark .bn-editor [data-text-color='orange'],
.dark .bn-editor [data-style-type='textColor'][data-value='orange'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='orange']) {
  color: #f6ad55 !important;
}

.dark .bn-editor [data-text-color='yellow'],
.dark .bn-editor [data-style-type='textColor'][data-value='yellow'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='yellow']) {
  color: #ecc94b !important;
}

.dark .bn-editor [data-text-color='green'],
.dark .bn-editor [data-style-type='textColor'][data-value='green'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='green']) {
  color: #68d391 !important;
}

.dark .bn-editor [data-text-color='blue'],
.dark .bn-editor [data-style-type='textColor'][data-value='blue'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='blue']) {
  color: #63b3ed !important;
}

.dark .bn-editor [data-text-color='purple'],
.dark .bn-editor [data-style-type='textColor'][data-value='purple'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='purple']) {
  color: #b794f4 !important;
}

.dark .bn-editor [data-text-color='pink'],
.dark .bn-editor [data-style-type='textColor'][data-value='pink'],
.dark .bn-editor .bn-block:has(> .bn-block-content[data-text-color='pink']) {
  color: #f687b3 !important;
}

/* Background colors - Dark mode */
.dark .bn-editor [data-background-color='gray'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='gray'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='gray']) {
  background-color: #3d3530 !important;
}

.dark .bn-editor [data-background-color='brown'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='brown'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='brown']) {
  background-color: #4a3728 !important;
}

.dark .bn-editor [data-background-color='red'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='red'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='red']) {
  background-color: #4a2020 !important;
}

.dark .bn-editor [data-background-color='orange'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='orange'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='orange']) {
  background-color: #4a2c10 !important;
}

.dark .bn-editor [data-background-color='yellow'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='yellow'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='yellow']) {
  background-color: #4a3d10 !important;
}

.dark .bn-editor [data-background-color='green'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='green'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='green']) {
  background-color: #1c3d2a !important;
}

.dark .bn-editor [data-background-color='blue'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='blue'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='blue']) {
  background-color: #1a3650 !important;
}

.dark .bn-editor [data-background-color='purple'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='purple'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='purple']) {
  background-color: #382952 !important;
}

.dark .bn-editor [data-background-color='pink'],
.dark .bn-editor [data-style-type='backgroundColor'][data-value='pink'],
.dark
  .bn-editor
  .bn-block:has(> .bn-block-content[data-background-color='pink']) {
  background-color: #4a1d33 !important;
}

/* ============================================
   Inline Text & Background Color Enhancements
   Better visual styling for targeted selections
   ============================================ */

/* Ensure inline colored text inherits properly */
.bn-editor .bn-inline-content span[data-style-type='textColor'] {
  transition: color 0.15s ease;
}

/* Inline background highlights - enhanced styling */
.bn-editor .bn-inline-content span[data-style-type='backgroundColor'] {
  transition: background-color 0.15s ease;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

/* Combined text + background styling */
.bn-editor
  .bn-inline-content
  span[data-style-type='textColor'][data-style-type='backgroundColor'],
.bn-editor
  .bn-inline-content
  span[data-style-type='backgroundColor']
  span[data-style-type='textColor'] {
  padding: 2px 4px;
  border-radius: 3px;
}

/* Ensure background colors have appropriate text contrast */
.bn-editor [data-style-type='backgroundColor'][data-value='yellow'] {
  color: #744210 !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='green'] {
  color: #1a472a !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='blue'] {
  color: #1a365d !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='red'] {
  color: #742a2a !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='orange'] {
  color: #652b19 !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='purple'] {
  color: #44337a !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='pink'] {
  color: #702459 !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='brown'] {
  color: #3d2312 !important;
}

.bn-editor [data-style-type='backgroundColor'][data-value='gray'] {
  color: #4a4239 !important;
}

/* Dark mode - background colors need light text */
.dark .bn-editor [data-style-type='backgroundColor'][data-value='yellow'] {
  color: #faf089 !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='green'] {
  color: #9ae6b4 !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='blue'] {
  color: #90cdf4 !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='red'] {
  color: #feb2b2 !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='orange'] {
  color: #fbd38d !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='purple'] {
  color: #d6bcfa !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='pink'] {
  color: #fbb6ce !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='brown'] {
  color: #e8d5c4 !important;
}

.dark .bn-editor [data-style-type='backgroundColor'][data-value='gray'] {
  color: #e3dcd0 !important;
}

/* BlockNote checkbox styling */
.bn-block-content[data-content-type='checkListItem'] input[type='checkbox'] {
  accent-color: hsl(var(--primary));
}

/* BlockNote quotes */
.bn-block-content[data-content-type='quote'] {
  border-left-color: hsl(var(--primary)) !important;
  color: hsl(var(--muted-foreground));
  padding-left: 16px;
}

/* BlockNote Formatting Toolbar - compact app-consistent */
.bn-formatting-toolbar {
  background-color: hsl(var(--card)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
  padding: 3px !important;
  gap: 1px !important;
}

/* Formatting toolbar buttons - compact */
.bn-formatting-toolbar button,
.bn-shadcn .bn-formatting-toolbar button {
  padding: 5px 6px !important;
  border-radius: 4px !important;
  min-width: auto !important;
  height: auto !important;
}

.bn-formatting-toolbar button svg,
.bn-shadcn .bn-formatting-toolbar button svg {
  width: 14px !important;
  height: 14px !important;
}

/* Block type select dropdown - compact */
.bn-formatting-toolbar [data-bn-block-type-select],
.bn-shadcn .bn-formatting-toolbar [data-bn-block-type-select] {
  font-size: 12px !important;
  padding: 4px 8px !important;
  min-width: auto !important;
  height: auto !important;
}

/* Block type select popover content - compact */
.bn-shadcn .bn-block-type-select-popover,
.bn-shadcn
  [class*='BlockTypeSelect']
  [data-radix-popper-content-wrapper]
  > div {
  background-color: hsl(var(--popover)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  padding: 4px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
  min-width: 160px !important;
}

.bn-shadcn [class*='BlockTypeSelect'] button[role='option'] {
  border-radius: 4px !important;
  padding: 6px 8px !important;
  font-size: 13px !important;
  gap: 8px !important;
}

.bn-shadcn [class*='BlockTypeSelect'] button[role='option']:hover,
.bn-shadcn [class*='BlockTypeSelect'] button[role='option'][data-highlighted] {
  background-color: hsl(var(--accent)) !important;
}

.bn-shadcn [class*='BlockTypeSelect'] button[role='option'] svg {
  width: 14px !important;
  height: 14px !important;
}

/* BlockNote Link Toolbar - compact */
.bn-link-toolbar {
  background-color: hsl(var(--card)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
  padding: 4px !important;
}

.bn-link-toolbar input {
  font-size: 13px !important;
  padding: 4px 8px !important;
}

.bn-link-toolbar button {
  padding: 4px 6px !important;
  border-radius: 4px !important;
}

/* BlockNote Image Toolbar - compact */
.bn-image-toolbar {
  background-color: hsl(var(--card)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
}

/* BlockNote File Panel - compact */
.bn-file-panel {
  background-color: hsl(var(--card)) !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: 6px !important;
  box-shadow:
    0 4px 16px -4px rgba(22, 23, 24, 0.12),
    0 2px 8px -2px rgba(22, 23, 24, 0.08) !important;
}

/* Keyboard shortcuts in BlockNote menus - compact app-consistent */
.bn-shadcn kbd,
.bn-shadcn .bn-suggestion-menu-item-hint {
  color: hsl(var(--muted-foreground)) !important;
  font-size: 10px !important;
  font-family:
    ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace !important;
  background-color: hsl(var(--muted) / 0.7) !important;
  border: 1px solid hsl(var(--border) / 0.4) !important;
  padding: 1px 4px !important;
  border-radius: 3px !important;
  line-height: 1.4 !important;
  margin-left: auto !important;
}

/* ============================================
   Notes-specific Animations & Utilities
   ============================================ */

/* Note item hover animation */
.note-item-hover {
  transition:
    background-color 0.15s ease,
    transform 0.15s ease,
    border-color 0.15s ease;
}

.note-item-hover:hover {
  transform: translateX(2px);
}

/* Note icon hover scale */
.note-icon-hover {
  transition:
    transform 0.15s ease,
    background-color 0.15s ease;
}

.note-icon-hover:hover {
  transform: scale(1.05);
}

.note-icon-hover:active {
  transform: scale(0.95);
}

/* Smooth fade transition for edit modes */
.note-edit-transition {
  transition:
    opacity 0.15s ease,
    transform 0.15s ease;
}

/* Staggered animation for list items */
@keyframes note-item-fade-in {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.note-item-stagger {
  animation: note-item-fade-in 0.3s ease forwards;
}

.note-item-stagger:nth-child(1) {
  animation-delay: 0ms;
}
.note-item-stagger:nth-child(2) {
  animation-delay: 30ms;
}
.note-item-stagger:nth-child(3) {
  animation-delay: 60ms;
}
.note-item-stagger:nth-child(4) {
  animation-delay: 90ms;
}
.note-item-stagger:nth-child(5) {
  animation-delay: 120ms;
}
.note-item-stagger:nth-child(6) {
  animation-delay: 150ms;
}
.note-item-stagger:nth-child(7) {
  animation-delay: 180ms;
}
.note-item-stagger:nth-child(8) {
  animation-delay: 210ms;
}
.note-item-stagger:nth-child(9) {
  animation-delay: 240ms;
}
.note-item-stagger:nth-child(10) {
  animation-delay: 270ms;
}

/* Saving indicator animation */
@keyframes saving-pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.saving-indicator {
  animation: saving-pulse 1.5s ease-in-out infinite;
}

/* Database cell focus ring */
.database-cell-focus {
  transition:
    box-shadow 0.15s ease,
    border-color 0.15s ease;
}

.database-cell-focus:focus-within {
  box-shadow: 0 0 0 2px hsl(var(--ring) / 0.2);
  border-color: hsl(var(--ring));
}

/* Notes breadcrumb link animation */
.breadcrumb-link {
  position: relative;
  transition: color 0.15s ease;
}

.breadcrumb-link::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 0;
  height: 1px;
  background: hsl(var(--foreground));
  transition: width 0.2s ease;
}

.breadcrumb-link:hover::after {
  width: 100%;
}

/* ============================================
   Additional Notes Component Styles
   ============================================ */

/* Table of Contents floating sidebar */
.toc-floating {
  background: hsl(var(--card) / 0.7);
  backdrop-filter: blur(8px);
  border: 1px solid hsl(var(--border) / 0.4);
  box-shadow: 0 4px 12px hsl(var(--foreground) / 0.05);
}

/* Calendar view day cells */
.calendar-day-cell {
  background: transparent;
  transition: background-color 0.15s ease;
}

.calendar-day-cell:hover {
  background: hsl(var(--accent) / 0.3);
}

.calendar-day-today {
  background: hsl(var(--primary) / 0.1);
}

/* Quick switcher dialog */
.quick-switcher-item {
  transition: background-color 0.1s ease;
}

.quick-switcher-item[data-selected='true'] {
  background: hsl(var(--accent));
}

/* ============================================
   Command Menu (cmdk) Scroll Fixes
   ============================================ */

/* Ensure cmdk list is scrollable */
[cmdk-list] {
  max-height: min(400px, 50vh);
  overflow-y: auto;
  overflow-x: hidden;
  overscroll-behavior: contain;
  scroll-behavior: smooth;
  scrollbar-gutter: stable;
}

/* Smooth scrolling for command items when selected */
[cmdk-item][data-selected='true'] {
  scroll-margin: 8px;
}

/* Command group proper overflow handling */
[cmdk-group] {
  overflow: visible;
}

/* Filter toolbar pills */
.filter-pill {
  background: hsl(var(--muted) / 0.5);
  border: 1px solid hsl(var(--border) / 0.5);
  transition:
    background-color 0.15s ease,
    border-color 0.15s ease;
}

.filter-pill:hover {
  background: hsl(var(--accent) / 0.5);
  border-color: hsl(var(--border));
}

/* Cover image gradient overlays - ensure smooth blend */
.cover-gradient-overlay {
  background: linear-gradient(
    to bottom,
    transparent 50%,
    hsl(var(--background) / 0.5) 100%
  );
}

/* AI processing indicator pulse */
@keyframes ai-pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.05);
  }
}

.ai-processing {
  animation: ai-pulse 2s ease-in-out infinite;
}

/* Note property badge colors using theme palette */
.property-badge-gray {
  background: hsl(var(--muted));
  color: hsl(var(--muted-foreground));
}
.property-badge-brown {
  background: hsl(30 30% 85%);
  color: hsl(30 30% 30%);
}
.property-badge-orange {
  background: hsl(30 100% 90%);
  color: hsl(30 80% 35%);
}
.property-badge-yellow {
  background: hsl(45 100% 88%);
  color: hsl(45 80% 30%);
}
.property-badge-green {
  background: hsl(140 60% 88%);
  color: hsl(140 60% 25%);
}
.property-badge-blue {
  background: hsl(210 100% 90%);
  color: hsl(210 80% 35%);
}
.property-badge-purple {
  background: hsl(270 70% 90%);
  color: hsl(270 60% 35%);
}
.property-badge-pink {
  background: hsl(330 80% 90%);
  color: hsl(330 70% 35%);
}
.property-badge-red {
  background: hsl(0 80% 90%);
  color: hsl(0 70% 35%);
}

.dark .property-badge-brown {
  background: hsl(30 25% 25%);
  color: hsl(30 40% 75%);
}
.dark .property-badge-orange {
  background: hsl(30 60% 20%);
  color: hsl(30 80% 70%);
}
.dark .property-badge-yellow {
  background: hsl(45 60% 20%);
  color: hsl(45 80% 70%);
}
.dark .property-badge-green {
  background: hsl(140 40% 20%);
  color: hsl(140 60% 70%);
}
.dark .property-badge-blue {
  background: hsl(210 60% 20%);
  color: hsl(210 80% 70%);
}
.dark .property-badge-purple {
  background: hsl(270 50% 25%);
  color: hsl(270 60% 75%);
}
.dark .property-badge-pink {
  background: hsl(330 50% 25%);
  color: hsl(330 70% 75%);
}
.dark .property-badge-red {
  background: hsl(0 50% 25%);
  color: hsl(0 70% 75%);
}

/* Smooth page transitions */
.note-page-enter {
  animation: note-page-fade-in 0.2s ease;
}

@keyframes note-page-fade-in {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Focus visible improvements for accessibility */
.note-focus-ring:focus-visible {
  outline: none;
  ring: 2px solid hsl(var(--ring));
  ring-offset: 2px;
  ring-offset-color: hsl(var(--background));
}

/* ============================================
   Mobile Responsiveness for Notes
   ============================================ */

/* Mobile-first responsive utilities */
@media (max-width: 640px) {
  /* Notes sidebar - compact mode on mobile */
  .notes-sidebar {
    width: 100% !important;
    max-width: none !important;
  }

  /* Note header - stack controls vertically */
  .note-header-controls {
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-start;
  }

  /* Note breadcrumb - truncate on mobile */
  .note-breadcrumb {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Editor toolbar - wrap on mobile */
  .editor-toolbar,
  .bn-formatting-toolbar,
  .bn-shadcn .bn-formatting-toolbar {
    flex-wrap: wrap;
    gap: 0.25rem;
  }

  /* BlockNote formatting toolbar - scrollable on mobile */
  .note-editor-container .bn-formatting-toolbar {
    max-width: calc(100vw - 2rem) !important;
    overflow-x: auto !important;
    flex-wrap: nowrap !important;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .note-editor-container .bn-formatting-toolbar::-webkit-scrollbar {
    display: none;
  }

  /* Database table - horizontal scroll */
  .database-table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Database table columns - min width for touch targets */
  .database-table-cell {
    min-width: 120px;
    padding: 0.75rem 0.5rem;
  }

  /* Kanban view - single column on mobile */
  .kanban-columns {
    flex-direction: column !important;
    gap: 1rem;
  }

  .kanban-column {
    width: 100% !important;
    min-width: 0 !important;
  }

  /* Gallery view - 1-2 columns on mobile */
  .gallery-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
    gap: 0.75rem;
  }

  /* Calendar view - compact mode */
  .calendar-grid {
    font-size: 0.75rem;
  }

  .calendar-day-cell {
    min-height: 60px !important;
    padding: 0.25rem !important;
  }

  /* Cover image picker - full width */
  .cover-picker-dialog {
    max-width: calc(100vw - 2rem) !important;
  }

  /* TOC - hide floating TOC on mobile, show button */
  .toc-floating-desktop {
    display: none !important;
  }

  /* Quick switcher - full width */
  .quick-switcher-dialog {
    max-width: calc(100vw - 2rem) !important;
    margin: 1rem;
  }

  /* Filter toolbar - stack vertically */
  .filter-toolbar {
    flex-direction: column;
    gap: 0.5rem;
    align-items: stretch;
  }

  .filter-toolbar .search-input {
    max-width: none;
  }

  /* AI status indicator - bottom center on mobile */
  .ai-status-indicator {
    left: 50% !important;
    right: auto !important;
    transform: translateX(-50%);
    bottom: 5rem !important;
  }

  /* Page width toggle - smaller on mobile */
  .page-width-toggle {
    position: absolute;
    right: 0.5rem;
  }
}

/* Tablet breakpoint adjustments */
@media (min-width: 641px) and (max-width: 1024px) {
  /* Notes sidebar - collapsible trigger */
  .notes-sidebar {
    width: 280px;
  }

  /* Gallery view - 2-3 columns */
  .gallery-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }

  /* Kanban view - 2-3 columns that scroll */
  .kanban-columns {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .kanban-column {
    min-width: 280px;
    flex-shrink: 0;
  }
}

/* Touch-friendly target sizes */
@media (pointer: coarse) {
  /* Increase touch target sizes for mobile */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }

  /* Note item in sidebar - larger touch target */
  .note-sidebar-item {
    min-height: 40px;
    padding: 0.5rem 0.75rem;
  }

  /* Database view controls - larger buttons */
  .database-controls button {
    min-height: 36px;
    min-width: 36px;
  }

  /* Dropdown menu items - larger on touch */
  .dropdown-menu-item {
    min-height: 40px;
  }
}

/* Safe area insets for notched devices */
@supports (padding: env(safe-area-inset-bottom)) {
  .notes-footer {
    padding-bottom: calc(1.25rem + env(safe-area-inset-bottom));
  }

  .notes-bottom-bar {
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* Landscape mobile optimization */
@media (max-height: 500px) and (orientation: landscape) {
  .note-header {
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }

  .cover-image-container {
    max-height: 120px;
  }
}

/* Print styles for notes */
@media print {
  .notes-sidebar,
  .note-header-controls,
  .ai-toolbar,
  .toc-floating,
  .saving-indicator {
    display: none !important;
  }

  .note-content {
    max-width: none !important;
    padding: 0 !important;
  }

  .cover-image-container {
    page-break-inside: avoid;
  }
}
